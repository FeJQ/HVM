__2020年10月14日__

项目已经写很大一部分了,有时会遇到某些以前遇到过的问题,但已经忘了当时的解决思路,于是打算在此记录一下项目的开发日志,以及遇到的问题和解决思路,供以后参考.

今天在尝试写隐藏断点,发现,对于一个内核函数所对应的Pte,默认情况下,eptAccess只有执行权限,且如果给了写权限后,会导致vmexit :ept misconfigration,不知是为什么

写的差不多了,我想测试一下效果,使用PCHunter查看NtLoadKey2函数,当用windbg给这个函数下断时,PCHunter会检测到该函数已被篡改.驱动里对这个函数所对应的pte进行了权限管理,只给了执行权限,而windbg下断应该是写入行为,照常来说,应该会断在vmexit:eptViolation处,但windbg在命令模式下无法断下来,再次'go'时,已经无法接管vmexit:eptViolation里的断点了,导致虚拟机和windbg同时卡死,我打算另写一个驱动来模拟windbg下断的这一行为.现下肚子饿了,点个外卖,听两首歌就回去.

__2020年10月18日__

由于"读"权限必定得伴随着"写"权限,所以上述利用其他方式来写断点的这以测试方式8太行,现改为在vmlauch前由程序本身来写入断点,但是好像也8太行,写入Int 3后,windbg没法接管这个断点异常,导致虚拟机调试器卡死.

